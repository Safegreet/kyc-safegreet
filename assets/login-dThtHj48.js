import{y as C,z as v,v as N,r as u,s as E,u as P,b as L,x as w,A as I,E as S,G as A,j as e,D as T,F as m,I as f,L as k,H as z,B as _,J as D}from"./index-DCoLUc3e.js";const F=({token:t=null})=>{const r=t&&C(t),o=async()=>(await N.get("/company/get",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`,"X-Tenant-UUID":r==null?void 0:r.tenant_uuid}})).data,{data:a,error:n,isLoading:c,isError:l,isSuccess:d,refetch:p}=v(["companyData",t],o,{enabled:!!t});return{companyData:a,companyError:n,isCompanyLoading:c,isCompanyError:l,isCompanySuccess:d,refetchCompanyData:p}},U=()=>{const[t,r]=u.useState(null),o=async s=>(await N.post("/user/login",s,{headers:{"Content-Type":"application/json","X-Tenant-UUID":s==null?void 0:s.alias}})).data,{companyData:a,companyError:n,isCompanyLoading:c,isCompanyError:l,isCompanySuccess:d}=F({token:t}),{mutate:p,data:x,error:h,isLoading:g,isError:y,isSuccess:j}=E(o,{onSuccess:s=>{var b;const i=(b=s==null?void 0:s.data)==null?void 0:b.jwt_token;r(i)}});return{mutate:p,data:x,error:h||n,isLoading:g||c,isError:y||l,isSuccess:j&&d,companyData:a}},R=({onLoginSuccess:t})=>{const{mutate:r,data:o,error:a,isLoading:n,isError:c,isSuccess:l,companyData:d}=U(),p=u.useRef(null),x=P(),h=L(),[g,y]=u.useState(""),j=s=>{D(g)?(s.identifier==="police"&&(s.identifier="admin"),s.identifier==="owner"&&(s.identifier="emp"),r(s)):w.error("CAPTCHA validation failed! Please try again.")};return u.useEffect(()=>{l&&(w.success("Login Success!"),h(I(o.data.jwt_token)),h(S(d.data)),x("/"))},[l,o,d]),u.useEffect(()=>{var s,i;c&&w.error(((i=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:i.data)??a.message)},[c,a]),u.useEffect(()=>{A(4,"#000","#fff","numbers")},[]),e.jsx(T,{children:e.jsx("main",{className:"relative h-full flex flex-col justify-center bg-indigo-500 overflow-hidden px-4",children:e.jsxs("div",{className:"w-100 max-w-6xl mx-auto px-0 md:px-6 my-2 mb-12 md:py-24",children:[e.jsx("h1",{className:"text-4xl text-white pacifico-regular w-100 text-center my-5",children:"SafeGreet!"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"w-full mx-auto text-center bg-white px-3 sm:px-5 py-3 rounded-xl shadow",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-indigo-500 mb-1",children:"Login"}),e.jsx("p",{className:"text-[15px] text-slate-500",children:"Please login using your email/phone and password."})]}),e.jsxs(m,{onFinish:j,ref:p,layout:"vertical",initialValues:{remember:!0},children:[e.jsx(m.Item,{name:"alias",label:"Identifier",rules:[{required:!0,message:"Please enter your domain identifier!"}],className:"!mb-2",children:e.jsx(f,{placeholder:"Enter domain identifier",className:"w-80 px-4 border rounded-md"})}),e.jsx(m.Item,{name:"identifier",label:"Email / Phone",rules:[{required:!0,message:"Please enter your email or username!"},{pattern:/^([6-9]\d{9}|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})$/,message:"Please enter a valid email / phone!"}],className:"!mb-2",children:e.jsx(f,{placeholder:"Enter your email or username",className:"w-80 px-4 border rounded-md"})}),e.jsx(m.Item,{name:"password",label:"Password",rules:[{required:!0,message:"Please enter your password!"},{min:6,message:"Password must be at least 6 characters!"}],className:"!mb-3",children:e.jsx(f.Password,{placeholder:"Enter your password",className:"w-80 px-4 border rounded-md"})}),e.jsx(m.Item,{className:"flex items-center justify-center !mb-2",children:e.jsxs("div",{className:"captcha-wrapper w-80",children:[e.jsx(k,{}),e.jsx(f,{placeholder:"Enter the CAPTCHA",className:"px-4 border rounded-md ",value:g,pattern:"[a-zA-Z0-9]{4}",onInput:s=>{s.target.value=s.target.value.replace(/[^a-zA-Z0-9]/g,"").toUpperCase()},onChange:s=>y(s.target.value)})]})}),e.jsx(m.Item,{name:"terms",valuePropName:"checked",rules:[{validator:(s,i)=>i?Promise.resolve():Promise.reject(new Error("You must accept the terms and conditions"))}],className:"!mb-3",children:e.jsxs(z,{children:["I agree to the"," ",e.jsx("a",{href:"/terms",target:"_blank",className:"text-indigo-500",children:"Terms"})," ","and"," ",e.jsx("a",{href:"/policy",target:"_blank",className:"text-indigo-500",children:"Privacy Policy"})]})}),e.jsx(_,{htmlType:"submit",className:"w-80 mt-1 bg-indigo-500 text-white px-2 rounded-lg",disabled:n,loading:n,children:n?"Logging in...":"Login"}),e.jsx("div",{className:"text-center w-full text-slate-500 mt-1 text-[12px] ",children:e.jsx("span",{className:"cursor-pointer text-indigo-500",onClick:()=>x("/reset-password"),children:"Forgot password? Click here to reset"})})]})]})})]})})})};export{R as default};
